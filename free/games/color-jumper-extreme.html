<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Color Jumper Extreme</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
:root {
  --bg:#0f1220;
  --panel:#161a2b;
  --text:#e5e7eb;
  --marker:#ff4444;
  --score:#fbbf24;
  --power:#34d399;
}
html,body {
  height:100%;
  margin:0;
  font-family:system-ui,Arial;
  background:radial-gradient(1200px 800px at 70% -10%, #1d2241 0%, var(--bg) 60%) no-repeat fixed;
  color:var(--text);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
}
canvas {
  background:var(--bg);
  border:2px solid var(--panel);
  border-radius:16px;
  box-shadow:0 0 20px #000a;
  width:90vw;
  height:80vh;
  max-width:700px;
}
#ui {
  position:fixed;
  top:10px;
  width:100%;
  text-align:center;
  font-size:18px;
  color:var(--text);
  text-shadow:0 0 10px #000;
}
#ui span {margin:0 10px;}
.controls {
  position:fixed;
  bottom:20px;
  display:flex;
  gap:10px;
}
button {
  background:var(--panel);
  border:none;
  color:var(--text);
  font-size:20px;
  padding:12px 20px;
  border-radius:12px;
  cursor:pointer;
}
</style>
</head>
<body>
<div id="ui">
  <span id="scoreLabel">Score: 0</span>
  <span id="platformLabel">Platforms: 0</span>
  <span id="levelLabel">Level: 1</span>
</div>
<canvas id="game"></canvas>
<div class="controls">
  <button id="leftBtn">&larr;</button>
  <button id="jumpBtn">&uarr;</button>
  <button id="rightBtn">&rarr;</button>
</div>
<button id="startBtn">Play</button>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=400; canvas.height=600;

let player,platforms=[],keys={},running=false,score=0,platformCount=0,cameraY=0,markers=[],scorePopups=[],trail=[];
let level=1;
const gravity=0.5,jumpPower=-12,playerSize=20,platformWidth=70,platformHeight=10;
const powerUpTypes=["score","jump"];
let powerUps=[];

function randomColor(){return "#"+Math.floor(Math.random()*16777215).toString(16).padStart(6,"0");}

function startGame(){
  running=true;
  score=0; platformCount=0; level=1; cameraY=0;
  platforms=[];
  powerUps=[];
  for(let i=0;i<50;i++){
    const x=Math.random()*(canvas.width-platformWidth);
    const y=canvas.height-i*60;
    platforms.push({x,y,color:"#38bdf8"});
    // 20% chance of power-up
    if(Math.random()<0.2) powerUps.push({x:x+platformWidth/2-10,y:y-15,type:powerUpTypes[Math.floor(Math.random()*powerUpTypes.length)],col:"var(--power)",collected:false});
  }
  player={x:platforms[0].x+platformWidth/2-playerSize/2,y:platforms[0].y-playerSize,vy:0,color:randomColor()};
  markers=[];
  for(let i=50;i<=1000;i+=50){markers.push({platformIndex:i,color:"var(--marker)"});}
  scorePopups=[];
  trail=[];
  document.getElementById("startBtn").style.display="none";
  loop();
}

function createPlatform(y){
  const x=Math.random()*(canvas.width-platformWidth);
  platforms.push({x,y,color:"#38bdf8"});
  if(Math.random()<0.2) powerUps.push({x:x+platformWidth/2-10,y:y-15,type:powerUpTypes[Math.floor(Math.random()*powerUpTypes.length)],col:"var(--power)",collected:false});
}

function update(){
  if(keys.a)player.x-=4;
  if(keys.d)player.x+=4;
  player.vy+=gravity;
  player.y+=player.vy;

  let grounded=false;
  for(const p of platforms){
    if(player.vy>0 &&
       player.x+playerSize>p.x && player.x<p.x+platformWidth &&
       player.y+playerSize>p.y && player.y+playerSize<p.y+platformHeight){
      player.vy=jumpPower;
      grounded=true;
      score+=10;
      platformCount++;
      scorePopups.push({x:player.x+playerSize/2,y:p.y-20-cameraY,alpha:1,text:"+10"});
      if(platformCount%50===0)level++;
    }
  }

  // Power-up collision
  for(const pu of powerUps){
    if(!pu.collected &&
       player.x+playerSize>pu.x && player.x<pu.x+20 &&
       player.y+playerSize>pu.y && player.y<pu.y+20){
      pu.collected=true;
      if(pu.type==="score") score+=50;
      if(pu.type==="jump") player.vy=jumpPower*1.5;
      scorePopups.push({x:pu.x+10,y:pu.y-10-cameraY,alpha:1,text:"+PU"});
    }
  }

  if(player.y>canvas.height+playerSize){running=false; document.getElementById("startBtn").style.display="block";}

  if(player.y<canvas.height/2) cameraY+=canvas.height/2 - player.y;
  if(player.x<0)player.x=0;
  if(player.x+playerSize>canvas.width)player.x=canvas.width-playerSize;

  if(platforms[platforms.length-1].y>cameraY-600) createPlatform(platforms[platforms.length-1].y-60);

  // Trail
  trail.push({x:player.x,y:player.y-cameraY,size:playerSize,alpha:0.5});
  if(trail.length>15)trail.shift();

  // Floating score popups
  scorePopups.forEach(p=>{p.y-=1; p.alpha-=0.02;});
  scorePopups=scorePopups.filter(p=>p.alpha>0);

  // UI
  document.getElementById("scoreLabel").textContent="Score: "+score;
  document.getElementById("platformLabel").textContent="Platforms: "+platformCount;
  document.getElementById("levelLabel").textContent="Level: "+level;
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Markers
  markers.forEach((m,i)=>{
    const idx=m.platformIndex-1;
    if(idx<platforms.length){
      const p=platforms[idx];
      const y=p.y-cameraY;
      ctx.strokeStyle=m.color;
      ctx.lineWidth=4;
      ctx.shadowColor=m.color;
      ctx.shadowBlur=10+5*Math.sin(Date.now()/300);
      ctx.beginPath();
      ctx.moveTo(0,y);
      ctx.lineTo(canvas.width,y);
      ctx.stroke();
      ctx.shadowBlur=0;
      ctx.fillStyle=m.color;
      ctx.font="bold 18px Arial";
      ctx.fillText(`LEVEL ${i+1}`,10,y-10);
    }
  });

  // Platforms
  for(const p of platforms){ctx.fillStyle=p.color;ctx.fillRect(p.x,p.y-cameraY,platformWidth,platformHeight);}

  // Power-ups
  for(const pu of powerUps){if(!pu.collected){ctx.fillStyle=pu.col;ctx.fillRect(pu.x,pu.y-cameraY,20,20);}}

  // Trail
  trail.forEach(t=>{ctx.beginPath();ctx.arc(t.x+playerSize/2,t.y+playerSize/2,t.size/2,0,Math.PI*2);ctx.fillStyle=`rgba(255,255,255,${t.alpha})`;ctx.fill();});

  // Player
  ctx.fillStyle=player.color;
  ctx.fillRect(player.x,player.y-cameraY,playerSize,playerSize);

  // Floating score popups
  scorePopups.forEach(s=>{ctx.globalAlpha=s.alpha;ctx.fillStyle="var(--score)";ctx.font="bold 16px Arial";ctx.fillText(s.text,s.x,s.y);});
  ctx.globalAlpha=1;
}

function loop(){if(!running)return;update();draw();requestAnimationFrame(loop);}

// Controls
document.addEventListener("keydown",e=>keys[e.key.toLowerCase()]=true);
document.addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false);

["leftBtn","rightBtn"].forEach(id=>{
  const key=id==="leftBtn"?"a":"d";
  const btn=document.getElementById(id);
  btn.addEventListener("touchstart",()=>keys[key]=true);
  btn.addEventListener("touchend",()=>keys[key]=false);
  btn.addEventListener("mousedown",()=>keys[key]=true);
  btn.addEventListener("mouseup",()=>keys[key]=false);
});
document.getElementById("jumpBtn").addEventListener("click",()=>{player.vy=jumpPower;});
document.getElementById("startBtn").onclick=startGame;
</script>
</body>
</html>
