<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Space Invaders PyScript</title>
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <style>
        canvas {
            background: black;
            display: block;
            margin: auto;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="600" height="400"></canvas>

    <py-script>
import js

# --- Canvas Setup ---
canvas = js.document.getElementById("gameCanvas")
ctx = canvas.getContext("2d")

# --- Player ---
player_x = 280
player_y = 360
player_speed = 10

# --- Bullet ---
bullet_x = 0
bullet_y = 0
bullet_speed = 8
bullet_active = False

# --- Enemies ---
enemies = [{"x": i*50, "y": 50} for i in range(10)]
enemy_speed = 2

# --- Draw Functions ---
def draw_player():
    ctx.fillStyle = "green"
    ctx.fillRect(player_x, player_y, 40, 20)

def draw_bullet():
    if bullet_active:
        ctx.fillStyle = "yellow"
        ctx.fillRect(bullet_x, bullet_y, 5, 10)

def draw_enemies():
    ctx.fillStyle = "red"
    for e in enemies:
        ctx.fillRect(e["x"], e["y"], 40, 20)

# --- Movement ---
def move_bullet():
    global bullet_y, bullet_active
    if bullet_active:
        bullet_y -= bullet_speed
        if bullet_y < 0:
            bullet_active = False

def move_enemies():
    for e in enemies:
        e["x"] += enemy_speed
    if any(e["x"] > 560 or e["x"] < 0 for e in enemies):
        for e in enemies:
            e["y"] += 20
        global enemy_speed
        enemy_speed *= -1

def check_collision():
    global bullet_active
    for e in enemies:
        if bullet_active and bullet_x < e["x"]+40 and bullet_x+5 > e["x"] and bullet_y < e["y"]+20 and bullet_y+10 > e["y"]:
            enemies.remove(e)
            bullet_active = False
            break

# --- Keyboard Controls ---
def keydown(event):
    global player_x, bullet_x, bullet_y, bullet_active
    key = event.key
    if key == "ArrowLeft":
        player_x = max(0, player_x - player_speed)
    elif key == "ArrowRight":
        player_x = min(560, player_x + player_speed)
    elif key == " ":
        if not bullet_active:
            bullet_x = player_x + 18
            bullet_y = player_y
            bullet_active = True

js.document.addEventListener("keydown", keydown)

# --- Game Loop ---
def game_loop(*args):
    ctx.clearRect(0, 0, 600, 400)
    draw_player()
    draw_bullet()
    draw_enemies()
    move_bullet()
    move_enemies()
    check_collision()
    js.requestAnimationFrame(game_loop)

game_loop()
    </py-script>
</body>
</html>
