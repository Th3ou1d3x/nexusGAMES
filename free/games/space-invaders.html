<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Space Invaders Extreme</title>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<style>
:root {
  --bg:#0f1220;
  --panel:#161a2b;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --marker:#f87171;
  --jump:#3b82f6;
  --score:#fbbf24;
  --speed:#f472b6;
}
*{box-sizing:border-box;}
html,body{height:100%;margin:0;font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Arial;background:radial-gradient(1200px 800px at 70% -10%, #1d2241 0%, var(--bg) 60%) no-repeat fixed;color:var(--text);display:flex;flex-direction:column;align-items:center;padding:16px;}
.wrap{width:min(92vw,520px);}
header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;}
h1{font-size:20px;margin:0;color:#fff;text-align:center;flex-grow:1;}
.stats{display:flex;gap:12px;align-items:center;font-size:14px;color:var(--muted);}
.stats b{color:#fff;}
.panel{position:relative;background:var(--panel);border:1px solid rgba(255,255,255,0.08);border-radius:14px;overflow:hidden;}
canvas{display:block;width:100%;height:auto;background:var(--panel);image-rendering:pixelated;aspect-ratio:1/1;}
.controls{display:flex;flex-direction:row;justify-content:center;gap:6px;margin-top:16px;}
.btn{min-width:48px;min-height:48px;font-size:20px;background:#101427;color:var(--text);border:1px solid rgba(255,255,255,0.08);border-radius:10px;cursor:pointer;}
.overlay{position:absolute;inset:0;display:grid;place-items:center;pointer-events:none;}
.notice{background:rgba(15,18,32,0.8);border:1px solid rgba(255,255,255,0.08);padding:18px 16px;border-radius:12px;text-align:center;max-width:90%;pointer-events:auto;}
.notice h2{margin:0 0 6px;font-size:20px;color:#fff;}
.notice p{margin:0 0 12px;color:var(--muted);font-size:14px;}
.back-btn{text-decoration:none;color:#e5e7eb;padding:6px 10px;background:#101427;border-radius:8px;border:1px solid rgba(255,255,255,0.08);}
</style>
</head>
<body>
<div class="wrap">
<header>
  <a href="/" class="back-btn">&larr; Back</a>
  <h1>Space Invaders Extreme</h1>
  <div class="stats">
    <span>Score: <b id="score">0</b></span>
    <span>Best: <b id="best">0</b></span>
  </div>
</header>

<div class="panel">
<canvas id="game" width="480" height="480"></canvas>
<div class="overlay" id="startOverlay">
<div class="notice">
<h2>Ready?</h2>
<p>Press <b>Enter</b> or click <b>Start</b> to play.</p>
<button id="startBtn">Start</button>
</div>
</div>
<div class="overlay" id="gameOverOverlay" style="display:none;">
<div class="notice">
<h2>Game Over</h2>
<button id="restartBtn">Restart</button>
</div>
</div>
</div>

<div class="controls">
<button class="btn" id="leftBtn">&larr;</button>
<button class="btn" id="shootBtn">&#8679;</button>
<button class="btn" id="rightBtn">&rarr;</button>
</div>
</div>

<script>
// Canvas setup
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
let STORAGE_KEY="spaceInvaders_best";

const playerWidth = 40, playerHeight = 20, playerSpeed = 5;
let player = {x:220, y:440, width:playerWidth, height:playerHeight};
let bullet = null;
let enemies = [];
let enemySpeed = 1;
let score = 0, best = parseInt(localStorage.getItem(STORAGE_KEY)||"0");
let running=false;

// Create enemies
function createEnemies(){
  enemies = [];
  for(let i=0;i<5;i++){
    for(let j=0;j<8;j++){
      enemies.push({x:20+j*50, y:20+i*40, width:40, height:20});
    }
  }
}

// Reset game
function reset(){
  player.x=220; player.y=440;
  bullet = null;
  score=0;
  enemySpeed=1;
  createEnemies();
}

// Draw everything
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // Player
  ctx.fillStyle="green";
  ctx.fillRect(player.x,player.y,player.width,player.height);

  // Bullet
  if(bullet){
    ctx.fillStyle="yellow";
    ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
  }

  // Enemies
  ctx.fillStyle="red";
  enemies.forEach(e=>ctx.fillRect(e.x,e.y,e.width,e.height));
}

// Update game logic
function update(){
  // Move bullet
  if(bullet){
    bullet.y-=5;
    // Collision with enemies
    for(let i=enemies.length-1;i>=0;i--){
      let e=enemies[i];
      if(bullet.x<e.x+e.width && bullet.x+bullet.width>e.x &&
         bullet.y<e.y+e.height && bullet.y+bullet.height>e.y){
        enemies.splice(i,1);
        bullet=null;
        score+=10;
        break;
      }
    }
    if(bullet && bullet.y<0) bullet=null;
  }

  // Move enemies
  let hitEdge=false;
  enemies.forEach(e=>{e.x+=enemySpeed;if(e.x<=0||e.x+e.width>=canvas.width) hitEdge=true;});
  if(hitEdge){enemySpeed*=-1; enemies.forEach(e=>e.y+=10);}

  // Check game over
  if(enemies.some(e=>e.y+e.height>=player.y)){
    running=false;
    if(score>best){best=score; localStorage.setItem(STORAGE_KEY,best);}
    document.getElementById("gameOverOverlay").style.display="grid";
  }

  document.getElementById("score").textContent=score;
  document.getElementById("best").textContent=best;
}

// Main loop
function loop(){
  if(!running) return;
  draw();
  update();
  requestAnimationFrame(loop);
}

// Keyboard input
const keys={};
document.addEventListener("keydown",e=>{
  keys[e.key.toLowerCase()]=true;
  if(e.key==="Enter" && !running){
    startGame();
  }
});
document.addEventListener("keyup",e=>{
  keys[e.key.toLowerCase()]=false;
});

// Control player
function handleInput(){
  if(keys["arrowleft"]) player.x=Math.max(0, player.x-playerSpeed);
  if(keys["arrowright"]) player.x=Math.min(canvas.width-player.width, player.x+playerSpeed);
  if(keys["arrowup"] && !bullet) bullet={x:player.x+player.width/2-2.5,y:player.y-10,width:5,height:10};
}

// Buttons
["leftBtn","rightBtn"].forEach(id=>{
  const key=id==="leftBtn"?"arrowleft":"arrowright";
  const btn=document.getElementById(id);
  btn.addEventListener("mousedown",()=>keys[key]=true);
  btn.addEventListener("mouseup",()=>keys[key]=false);
  btn.addEventListener("touchstart",()=>keys[key]=true);
  btn.addEventListener("touchend",()=>keys[key]=false);
});
document.getElementById("shootBtn").addEventListener("click",()=>{
  if(!bullet) bullet={x:player.x+player.width/2-2.5,y:player.y-10,width:5,height:10};
});

// Start/restart
function startGame(){
  reset();
  running=true;
  document.getElementById("startOverlay").style.display="none";
  document.getElementById("gameOverOverlay").style.display="none";
  requestAnimationFrame(mainLoop);
}

document.getElementById("startBtn").onclick=startGame;
document.getElementById("restartBtn").onclick=startGame;

// Main loop wrapper to include input
function mainLoop(){
  if(!running) return;
  handleInput();
  loop();
  requestAnimationFrame(mainLoop);
}
</script>
</body>
</html>
