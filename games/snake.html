<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Snake</title>
<link rel="icon" href="/favicon.ico">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<style>
  :root {
    --bg: #0f1220;
    --panel: #161a2b;
    --snake: #8b5cf6;
    --snake-head: #a78bfa;
    --food: #ef4444;
    --text: #e5e7eb;
    --muted: #9ca3af;
  }
  * { box-sizing: border-box; }
  html, body {
    height: 100%;
    margin: 0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    background: radial-gradient(1200px 800px at 70% -10%, #1d2241 0%, var(--bg) 60%) no-repeat fixed;
    color: var(--text);
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 16px;
  }
  .wrap { width: min(92vw, 520px); }
  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 12px;
  }
  h1 {
    font-size: 20px;
    margin: 0;
    color: #fff;
    text-align: center;
    flex-grow: 1;
  }
  .stats {
    display: flex;
    gap: 12px;
    align-items: center;
    font-size: 14px;
    color: var(--muted);
  }
  .stats b { color: #fff; }
  .back-btn {
    padding: 6px 10px;
    background: #101427;
    color: #e5e7eb;
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 8px;
    font-size: 14px;
    text-decoration: none;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.06);
  }
  .panel {
    position: relative;
    background: var(--panel);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 14px;
    overflow: hidden;
  }
  canvas {
    display: block;
    width: 100%;
    height: auto;
    background: var(--panel);
    image-rendering: pixelated;
    aspect-ratio: 1 / 1;
  }
  .controls {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
  }
  .controls .row {
    display: flex;
    gap: 6px;
  }
  .controls .btn {
    min-width: 48px;
    min-height: 48px;
    font-size: 20px;
    background: #101427;
    color: #e5e7eb;
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 10px;
    padding: 10px 12px;
    cursor: pointer;
  }
  @media (max-width: 768px) {
    .controls {
      position: absolute;
      bottom: 10px;
      right: 10px;
      background: rgba(0,0,0,0.3);
      padding: 8px;
      border-radius: 12px;
    }
  }
  @media (min-width: 769px) {
    .controls {
      position: static;
      margin-top: 16px;
      background: none;
      padding: 0;
    }
  }
  .toolbar {
    margin-top: 10px;
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 10px;
    font-size: 12px;
    color: var(--muted);
  }
  .tag {
    font-size: 11px;
    padding: 4px 8px;
    background: rgba(148,163,184,0.14);
    border: 1px solid rgba(148,163,184,0.22);
    color: #cbd5e1;
    border-radius: 999px;
  }
  .overlay {
    position: absolute;
    inset: 0;
    display: grid;
    place-items: center;
    pointer-events: none;
  }
  .notice {
    background: rgba(15,18,32,0.8);
    border: 1px solid rgba(255,255,255,0.08);
    padding: 18px 16px;
    border-radius: 12px;
    text-align: center;
    max-width: 90%;
    pointer-events: auto;
  }
  .notice h2 {
    margin: 0 0 6px;
    font-size: 20px;
    color: #fff;
  }
  .notice p {
    margin: 0 0 12px;
    color: var(--muted);
    font-size: 14px;
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <a href="/" class="back-btn">&larr; Back</a>
    <h1>Snake</h1>
    <div class="stats">
      <span>Score: <b id="score">0</b></span>
      <span>Best: <b id="best">0</b></span>
      <span class="tag" id="speedTag">Speed: 1x</span>
    </div>
  </header>

  <div class="panel">
    <canvas id="game" width="480" height="480"></canvas>
    <div class="overlay" id="startOverlay">
      <div class="notice">
        <h2>Ready?</h2>
        <p>Press <b>Enter</b> or tap <b>Start</b> to play.</p>
        <button id="startBtn">Start</button>
      </div>
    </div>
    <div class="overlay" id="gameOverOverlay" style="display:none;">
      <div class="notice">
        <h2>Game Over</h2>
        <button id="restartBtn">Restart</button>
      </div>
    </div>
  </div>

  <!-- D-PAD -->
  <div class="controls">
    <div class="row"><button class="btn" id="btnUp">&uarr;</button></div>
    <div class="row">
      <button class="btn" id="btnLeft">&larr;</button>
      <button class="btn" id="btnDown">&darr;</button>
      <button class="btn" id="btnRight">&rarr;</button>
    </div>
  </div>

  <div class="toolbar">
    <div>Pause: Space | Restart: Enter</div>
    <div>
      <button class="btn" id="pauseBtn">Pause</button>
      <button class="btn" id="slowBtn">- Speed</button>
      <button class="btn" id="fastBtn">+ Speed</button>
    </div>
  </div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const gridSize = 20;
const tileCount = canvas.width / gridSize;
let snake, food, dx, dy, score, best, speed, gameOver, running, paused;
const STORAGE_KEY = "snake_best";

function reset() {
  snake = [{ x: 10, y: 10 }];
  dx = 1; dy = 0;
  placeFood();
  score = 0;
  speed = 8;
  gameOver = false;
}

function placeFood() {
  food = { x: Math.floor(Math.random() * tileCount), y: Math.floor(Math.random() * tileCount) };
}

function startGame() {
  best = parseInt(localStorage.getItem(STORAGE_KEY) || "0", 10);
  reset();
  running = true;
  paused = false;
  ui.startOverlay.style.display = "none";
  ui.gameOverOverlay.style.display = "none";
  last = performance.now();
  acc = 0;
  requestAnimationFrame(loop);
  updateUI();
}

function endGame() {
  running = false;
  gameOver = true;
  updateUI();
}

const ui = {
  score: document.getElementById("score"),
  best: document.getElementById("best"),
  speedTag: document.getElementById("speedTag"),
  startOverlay: document.getElementById("startOverlay"),
  gameOverOverlay: document.getElementById("gameOverOverlay"),
  pauseBtn: document.getElementById("pauseBtn")
};

function updateUI() {
  ui.score.textContent = score;
  ui.best.textContent = best;
  ui.speedTag.textContent = `Speed: ${speed.toFixed(0)}x`;
  if (gameOver) { ui.gameOverOverlay.style.display = ""; }
  else if (!running) { ui.startOverlay.style.display = ""; }
  ui.pauseBtn.textContent = paused ? "Resume" : "Pause";
}

let last = 0;
let acc = 0;

function loop(timestamp) {
  if (!running) return;
  const delta = (timestamp - last) / 1000;
  last = timestamp;
  acc += delta;
  if (!paused && acc > 1 / speed) {
    acc = 0;
    update();
    draw();
  }
  requestAnimationFrame(loop);
}

function update() {
  const head = { x: snake[0].x + dx, y: snake[0].y + dy };
  if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount || snake.some(s => s.x === head.x && s.y === head.y)) {
    return endGame();
  }
  snake.unshift(head);
  if (head.x === food.x && head.y === food.y) {
    score++;
    if (score > best) { best = score; localStorage.setItem(STORAGE_KEY, best); }
    placeFood();
    speed += 0.2;
  } else {
    snake.pop();
  }
}

function roundRectPath(x, y, w, h, r) {
  ctx.beginPath();
  ctx.moveTo(x + r, y);
  ctx.arcTo(x + w, y, x + w, y + h, r);
  ctx.arcTo(x + w, y + h, x, y + h, r);
  ctx.arcTo(x, y + h, x, y, r);
  ctx.arcTo(x, y, x + w, y, r);
  ctx.closePath();
}

function draw() {
  ctx.fillStyle = "#161a2b";
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = "#ef4444";
  roundRectPath(food.x * gridSize + 1, food.y * gridSize + 1, gridSize - 2, gridSize - 2, 3);
  ctx.fill();
  for (let i = snake.length - 1; i >= 0; i--) {
    ctx.fillStyle = i === 0 ? "#a78bfa" : "#8b5cf6";
    roundRectPath(snake[i].x * gridSize + 1, snake[i].y * gridSize + 1, gridSize - 2, gridSize - 2, 3);
    ctx.fill();
  }
}

document.addEventListener("keydown", e => {
  if ((e.key === "ArrowUp" || e.key.toLowerCase() === "w") && dy === 0) { dx = 0; dy = -1; }
  if ((e.key === "ArrowDown" || e.key.toLowerCase() === "s") && dy === 0) { dx = 0; dy = 1; }
  if ((e.key === "ArrowLeft" || e.key.toLowerCase() === "a") && dx === 0) { dx = -1; dy = 0; }
  if ((e.key === "ArrowRight" || e.key.toLowerCase() === "d") && dx === 0) { dx = 1; dy = 0; }
  if (e.key === "Enter") { if (!running || gameOver) startGame(); }
  if (e.key === " ") { if (running && !gameOver) { paused = !paused; if (!paused) requestAnimationFrame(loop); updateUI(); } }
});

document.getElementById("btnUp").onclick = () => { if (dy === 0) { dx = 0; dy = -1; } };
document.getElementById("btnDown").onclick = () => { if (dy === 0) { dx = 0; dy = 1; } };
document.getElementById("btnLeft").onclick = () => { if (dx === 0) { dx = -1; dy = 0; } };
document.getElementById("btnRight").onclick = () => { if (dx === 0) { dx = 1; dy = 0; } };

document.getElementById("startBtn").onclick = startGame;
document.getElementById("restartBtn").onclick = startGame;
document.getElementById("pauseBtn").onclick = () => { if (running && !gameOver) { paused = !paused; if (!paused) requestAnimationFrame(loop); updateUI(); } };
document.getElementById("slowBtn").onclick = () => { speed = Math.max(1, speed - 1); updateUI(); };
document.getElementById("fastBtn").onclick = () => { speed += 1; updateUI(); };

updateUI();
</script>
</body>
</html>
